---
name: prompt-version-editor
description: 严格变更控制下编辑、版本化并存储提示词。用于用户要求小改/局部优化/补丁式修订、修复提示词失败、添加或维护版本头、对比版本，或基于输入/思路/输出诊断问题时。强制版本控制、作者签名，并将版本保存到 /Users/wisewong/Documents/Developer/prompts。
---

# Prompt 版本编辑器

## 质量优先级（置顶）

1. 指令结构 MECE（不重叠、不遗漏）。
2. 去除歧义（定义术语、输入、输出与成功标准）。
3. 解决逻辑错误与冲突（顺序、优先级、“must/should/may”、矛盾）。
4. 修复提示词“漏洞”（提示注入面、工具/权限滥用、数据泄露、不安全委派）。
5. 严格变更控制（仅编辑批准范围，默认保留其余内容）。

## 适用范围判定（优先执行）

先判断“局部修订”还是“大改重写”，不确定就让用户选择。

- 视为“大改重写”的信号：
  - 任务目标/受众/场景发生变化
  - 需要更换整体结构或引入新框架
  - 输出格式大幅重排（超过约 30% 内容需重写）
  - 需要引入大量新模块或删掉核心段落
- 处理规则：
  - 若判断为“大改重写”，先停止本流程，建议切换到 `omega-prompt-forge`。
  - 若无法判断或用户表达“重写/大改/重构”，询问用户选择：
    - 选项 A：局部修订（走本技能）
    - 选项 B：大改重写（走 omega-prompt-forge）
  - 若用户坚持用本技能做大改：继续但在风险/限制中说明“结构性重写不保证质量，建议切换”。

## 工作流

1. 确定任务名；若缺失，向用户索要简短 task slug。
2. 定位任务目录：`/Users/wisewong/Documents/Developer/prompts/<task-slug>/`。
3. 读取该目录下最新版本提示词文件（最高版本号）。若不存在，将用户提供的提示词视为 v1.0。
4. 对比最新保存版本与用户提供版本；若差异超出请求范围，询问哪个为权威版本。
5. 确认编辑范围与不丢失原则：
   - 询问允许改动的段落/区块（“指定位置”）；不明确时提出范围并请求确认。
   - 默认：范围外文本保持完全一致（含标点、换行与顺序）。
   - 如需改动范围外内容，先请求扩展范围；若被拒，记录残留问题/风险。
   - 如需删除内容，事先列出将删除的具体内容及原因，并征求同意。
6. 收集必要输入：
   - 当前提示词文本
   - 问题描述
   - 可选：输入、模型“思路”（由用户提供）与输出
7. 结构化诊断（不要为了“最小改动”牺牲质量）：
   - 先检查 MECE、歧义、逻辑/冲突、漏洞。
   - 将每个问题映射到可修复的最小“已批准范围”内；否则请求扩展范围。
8. 以范围化 diff 形式提出修改：
   - 只展示变更段落的前后对比
   - 其他内容保持不变（不改写、不重排），除非明确获批
9. 在输出完整修订稿前先请求确认。
10. 确认后：
   - 更新版本号
   - 输出完整修订提示词
   - 保存为任务目录下的新版本文件（不覆盖旧版本）

## 版本与存储规则

- 版本格式：`v<major>.<minor>`，例如 `v1.0`、`v1.1`。
- 默认递增：每次获批修订将 minor +1（`v1.0` -> `v1.1`）。
- 若用户指定版本，使用该版本。
- 版本号需同时出现在头部和文件名中。
- 默认文件名：`prompt_<version>.md`（例如：`prompt_v1.0.md`）。若用户提供文件名/扩展名，保持原样。

## 必须的头部（提示词顶部）

- 必须放在最顶部。
- Author 使用固定句柄 `@歪斯Wise`。
- Model 为逗号分隔列表。
- 若提示词已有头部，保留其标点样式。

模板：

```
// {
// Author: @歪斯Wise
// Model: GPT5.2, Gemini 3
// Version: v1.0
// }
```

若缺少 Model，最终定稿前先向用户索取模型列表。

## 变更控制

- “最小改动”指“范围内改动”：只改已批准范围内且必要的内容。
- 默认逐字保留其余内容；不得意外删改。
- 若需删除或移动内容，必须先征得用户明确批准，并逐条列出删除/移动项。
- 若需新增指令，将其插入到相关段落附近，避免全局重写。

## 使用输入/思路/输出诊断

- 用提供的输入/输出定位具体失效点。
- 将用户提供的“思路”视为上下文信息；不请求或复述 chain-of-thought。

## 输出前自检

- 头部包含 Author、Model、Version。
- 版本已递增且文件名匹配。
- 除已批准的删除/移动/修改外，不丢失上一版本内容。
- 提示词 MECE 且无歧义（必要处定义术语/输入/输出）。
- 冲突已解决（优先级清晰、无矛盾）。
- 漏洞面已降低（注入/权限/泄露风险已处理或在超范围时明确标注）。
- 删除空洞强调词（如“本次强化”“重要”“重点”“请注意”），除非确有行动价值。

## 输出格式

- 提案阶段：总结问题，仅展示变更段落的前后对比，并请求确认。
- 完成阶段：在单一代码块中输出完整修订提示词，并确认保存路径。
